[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Lab Test Structure",
  "enabled": 1,
  "modified": "2021-01-06 11:21:22.452817",
  "name": "Lab Test Structure-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Subjective Parameter Lab Test Structure', {\n    subjective_parameter: function(frm, cdt, cdn){\n        \n        var sidx = frappe.get_doc(cdt,cdn).idx - 1;\n        var subjective_row = frm.fields_dict.subjective_parameter_lab_test_structure.grid.grid_rows[sidx]\n        var subjective_parm_value = locals[cdt][cdn].subjective_parameter\n        \n        var valid_values = subjective_row.get_field('target_value');\n        \n        console.dir(sidx)\n        console.dir(subjective_row)\n        console.dir(subjective_parm_value)\n        console.dir(valid_values)\n        \n        // valid_values.get_query= function(){return{ \"filters\" : {}}}\n        \n        valid_values.get_query=function(cdt,cdn){\n            return {\n                filters : [\n                    ['Subjective Parameter Valid Values','parent','=',subjective_parm_value]\n                ]\n            }\n        }\n        cur_frm.refresh\n        \n    }\n})\n\nfrappe.ui.form.on('Lab Test Structure',\"onload\", function(frm){\n\t// your code here\n    cur_frm.fields_dict['project'].get_query=function(frm) {\n\t    return {\n\t\t    filters: [['Project','status','=',\"Open\"]\n\t\t    \n            ]\n        }\n\t \n    };\n    cur_frm.refresh\n})\n\n\n//  https://discuss.erpnext.com/t/help-filtering-child-items-based-on-same-child-table-field/19209/8\n//  https://discuss.erpnext.com/t/child-table-calculation/18840\n//  https://discuss.erpnext.com/t/get-exact-row-id-number-in-table/45043/7\n//  https://discuss.erpnext.com/t/how-to-make-a-quotation-record-from-material-receipt-entry/5250/6\n//  https://discuss.erpnext.com/t/minor-tutor-a-table-with-child-table-let-do-the-impossible/19545\n\n// /*\n//refresh: function(frm,cdt,cdn) { \n//\t        //frm.set_query(\"subjective_parameter_lab_test_structure\", \"valid_values\")\n//\t        var subjective_row = cur_frm.fields_dict['subjective_parameter_lab_test_structure']\n//\t        var valid_row = subjective_row.grid.get_field('valid_values')\n//\t        console.dir(subjective_row);\n//\t        console.dir(valid_row);\n//\n//\t        // cur_frm.fields_dict['subjective_parameter_lab_test_structure']\n//\t        // .grid.get_field('valid_values').grid.get_field('subjective_parameter').get_query=\n//\n//\t        valid_row.grid.get_field('subjective_parameter').get_query=function(doc, cdt, cdn){\n//\t            //var child =locals[cdt][cdn];\n//\t            return {\n//\t                filters : [\n//\t                    ['valid_values','subjective_parameter',\"=\", subjective_row.subjective_parameter]\n//\t                ]\n//\t            }\n//\t        }\n//\t    }\n//\t    \n//*/\n        //var subjective_row = $('.data-row.editable-row').parent().attr(\"data-name\");\n        //var subjective_parm_value= locals[cdt][cdn][\"Subjective Paramter\"];\n        //var valid_values=locals[cdt][cdn][\"Valid Values\"];\n        //var subjective_row=frappe.get_doc(cdt,cdn);\n        //var subjective_row = cur_frm.fields_dict['subjective_parameter_lab_test_structure']\n        // cur_frm.fields_dict[\"subjective_parameter_lab_test_structure\"].grid.get_docfield('valid_values')\n        //var valid_values=subjective_row.grid.get_docfield('valid_values')\n        //valid_row.read_only=1; //testing\n        //subjective_parm.read_only=1;\n        //console.dir(subjective_parm_value)\n        //console.dir(subjective_row)\n",
  "view": null
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Salary Slip",
  "enabled": 1,
  "modified": "2020-12-17 15:02:33.589950",
  "name": "Salary Slip-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Salary Slip', {\n\t\"employee\": function(frm){\n\t// your code here\n\t    cur_frm.fields_dict['salary_structure_assignment'].get_query=function(frm) {\n    \t    return {\n    \t\t    filters: [['Salary Structure Assignment','employee','=',frm.employee]]\n    \t    }\n    \t \n        };\n    }\n}\n)\n\n//https://discuss.erpnext.com/t/is-it-possible-in-unsaved-form-to-use-get-query-method-with-filter-that-contain-one-of-forms-values/30153\n//https://discuss.erpnext.com/t/on-change-event/37526/2\n//https://frappeframework.com/docs/user/en/guides/app-development/overriding-link-query-by-custom-script",
  "view": null
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Daily Dosage",
  "enabled": 1,
  "modified": "2021-01-09 10:43:44.408263",
  "name": "Daily Dosage-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Daily Dosage', 'refresh', function(frm) {\n    cur_frm.fields_dict['project'].get_query=function(frm) {\n        return {\n\t\t    filters: [['Project','status','=',\"Open\"]\n\t\t    \n            ]\n        };\n     \n    };\n\n});\n\n\n// dosage_structure (Lab test structure) should only be for the product and active\nfrappe.ui.form.on('Daily Dosage', 'project', function(frm) {\n    cur_frm.fields_dict['dosage_structure'].get_query=function(frm) {\n        return {\n\t\t    filters: [['Lab Test Structure','Project','=',frm.project],\n                        ['Lab Test Structure','Active','=',1]\n\t\t    \n            ]\n        };\n     \n    };\n\n});\n\n// fill up the daily dosage valeus table - and set the reference value\nfrappe.ui.form.on('Daily Dosage', {\n    dosage_structure: function(frm, cdt, cdn) {\n        frm.clear_table(\"daily_dosage_values\"); \n        console.dir(frm.doc.dosage_structure);\n        frappe.model.with_doc(\"Lab Test Structure\",frm.doc.dosage_structure, function() {\n            var source_doc=frappe.model.get_doc(\"Lab Test Structure\",frm.doc.dosage_structure);\n            console.dir(source_doc);\n            $.each(source_doc.dosage_structure, function(index, source_row){\n                console.dir(source_row.effective_from_date);\n                console.dir(frm.doc.dosage_date_time);\n                if (source_row.is_active==1 && source_row.effective_from_date<=frm.doc.dosage_date_time){\n                    var d = frm.add_child('daily_dosage_values')\n                    d.dosing_product = source_row.dosing_product;\n                    d.reference_dosing_amount = source_row.dosage_amount;\n                }\n                //d.remarks = 'Effective from:'.concat(source_row.effective_date.toString);\n            });cur_frm.refresh_field('daily_dosage_values');\n            \n        });\n    }\n    \n\n});\n\n",
  "view": null
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Water Height Measurement",
  "enabled": 1,
  "modified": "2021-06-18 22:12:17.472384",
  "name": "Water Height Measurement-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "var dateformat=\"YYYY-MM-DD\";\nfrappe.ui.form.on('Water Height Measurement', 'onload', function(frm) {\n    cur_frm.fields_dict['project'].get_query=function(frm) {\n        return {\n\t\t    filters: [['Project','status','=',\"Open\"]]\n        };\n    };\n    console.dir('sample order')\n    cur_frm.set_query('sample_location', function(doc){\n        return {order_by:'sample_location asc' }\n    });\n    frm.refresh_field('sample_location');\n    if (frm.docstatus==0){\n        frm.set_value('label_date', moment(frm.fields_dict['measurement_date__time'].value).format(dateformat) )\n    }\n});\n\nfrappe.ui.form.on('Water Height Measurement', {\n    //console.dir('--------------------Flow calc')\n    'height': function(frm){\n        var TotalSeconds=(24*60*60/1000); // # of seconds in a day, divided by 1000 to convert to MLD\n        var water_height = flt(frm.doc.height)/100  // converting from cm to m\n        //\n        var L=flt(frm.doc.crest_length);\n        var FlowPerSec=0;\n        var wier_type = frm.doc.biox_wier_notch_type;\n        // console.dir(wier_type);console.dir(L); console.dir(water_height);console.dir(water_height**1.5)\n        if(wier_type=='Rectangular'){\n            FlowPerSec = 1.85*L*(water_height**1.5); console.dir(FlowPerSec)\n            \n        } else {\n            FlowPerSec = 1.42*(water_height**2.5);\n            \n        }\n        //console.dir(FlowPerSec); console.dir(TotalSeconds)\n        frm.set_value(\"calculated_daily_volume\", flt(FlowPerSec)*flt(TotalSeconds));\n\n    }\n});\n\n\nfrappe.ui.form.on('Water Height Measurement', {\n    //console.dir('--------------------Flow calc')\n    'measurement_date__time': function(frm){\n          frm.set_value('label_date', moment(frm.fields_dict['measurement_date__time'].value).format(dateformat) )\n      }\n      \n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Lab Test Results",
  "enabled": 1,
  "modified": "2021-06-21 09:01:47.322312",
  "name": "Lab Test Results-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "\r\nvar SubjTable='subjective_parameter_lab_test_results',SubjResults='test_result', SubjParm='subjective_parameter';\r\n//var fieldsArray = [\"field1\",\"field2\",\"fieldx\"];\r\n////////////////////////////////////////////////////////////////////////////////\r\nfrappe.ui.form.on('Subjective Parameter Lab Test Results', {\r\n    subjective_parameter: function(frm, cdt, cdn){\r\n            \r\n            var sidx = frappe.get_doc(cdt,cdn) - 1 ;\r\n            var subj_row = cur_frm.fields_dict.subjective_parameter_lab_test_results.grid.grid_rows[sidx];\r\n             console.dir(sidx);console.dir(cdt);console.dir(cdn);console.dir(subj_row);\r\n            var TEST_RESULT = subj_row.get_field('test_result');\r\n            \r\n            //var valid_values = frappe.utils.filter_dict(grid_row.docfields, {fieldname: cField})[0];\r\n           \r\n            \r\n            var subjective_parm_value = child[SubjParm];\r\n            \r\n            \r\n            \r\n            console.dir(TEST_RESULT); console.dir(subjective_parm_value);\r\n            \r\n            TEST_RESULT.get_query=function(){\r\n                return {\r\n                    filters : [\r\n                        ['Subjective Parameter Valid Values','parent','=',subjective_parm_value]\r\n                    ]\r\n                };\r\n            };\r\n            \r\n            cur_frm.refresh_field(SubjTable);\r\n    }\r\n    \r\n});\r\n\r\n\r\n\r\nfrappe.ui.form.on('Lab Test Results',\"project\", function(frm){\r\n    // your code here\r\n    cur_frm.fields_dict['lab_test_structure'].get_query=function(frm) {\r\n        return {\r\n            filters: [  ['Lab Test Structure','Project','=',frm.project],\r\n                        ['Lab Test Structure','Active','=',1]\r\n            ]\r\n        };\r\n     \r\n    };\r\n});\r\n\r\nfrappe.ui.form.on('Lab Test Results',\"onload\", function(frm){\r\n    // your code here\r\n    cur_frm.fields_dict['project'].get_query=function(frm) {\r\n        return {\r\n            filters: [['Project','status','=',\"Open\"]\r\n            ]\r\n        }\r\n     \r\n    };\r\n    cur_frm.refresh;\r\n    $(\".grid-add-row\").hide();\r\n});\r\n\r\n\r\nfrappe.ui.form.on('Lab Test Results', \"lab_test_structure\", function(frm) {\r\n        console.log(frm);\r\n        // frm.clear_table(\"parameter_lists\");\r\n        frappe.model.with_doc(\"Lab Test Structure\",frm.doc.lab_test_structure, function() {\r\n            frm.clear_table(\"parameters_list\");\r\n            var source_doc=frappe.model.get_doc(\"Lab Test Structure\",frm.doc.lab_test_structure);\r\n            console.log(source_doc);\r\n            $.each(source_doc.parameters_list, function(index, source_row){\r\n                var d = frm.add_child(\"parameters_list\");\r\n                d.parameter=source_row.parameter;\r\n                d.sample_position=source_row.sample_position;\r\n                d.uom=source_row.uom;\r\n            }); cur_frm.refresh_field('parameters_list');\r\n            \r\n            // commented out on Apr 18 2021, by Satish Vijayan. Removed Subjective Parameters\r\n            // frm.clear_table(SubjTable);\r\n            // $.each(source_doc.subjective_parameter_lab_test_structure, function(index, source_row){\r\n            //    var d = frm.add_child(SubjTable);\r\n            //    frappe.model.set_value(d.doctype, d.name, SubjParm, source_row.subjective_parameter);\r\n                //\r\n                //frm.trigger(SubjParm)\r\n            //});\r\n            //cur_frm.refresh_field(SubjTable);\r\n            \r\n        });\r\n            \r\n});\r\n\r\n\r\nfrappe.ui.form.on('Lab Test Results', {\r\n    refresh_: function(frm,cdt,cdn){\r\n        \r\n        //frappe.model.with_doc(\"Lab Test Results\",frm.doc.lab_test_results, function() {\r\n        // frm.trigger('subjective_test_results')\r\n        //}) // not used for now\r\n    }\r\n});\r\n\r\n\r\n\r\n// https://discuss.erpnext.com/t/set-filter-in-child-table-with-value-from-same-table/10929/2\r\n//https://discuss.erpnext.com/t/fetch-the-table-from-customer-into-the-quotation-by-custom-script/42026/6\r\n//https://discuss.erpnext.com/t/help-needed-on-frappe-call-method/7089\r\n//https://discuss.erpnext.com/t/filter-with-like-in-frappe-client-get-list/67620\r\n//https://discuss.erpnext.com/t/how-to-fetch-child-tables/12348/11\r\n//https://discuss.erpnext.com/t/how-to-hide-remove-button-in-child-table/9421/8\r\n// https://discuss.erpnext.com/t/firing-a-event-function-when-changing-any-field-value-in-doc/49772/5\r\n// https://discuss.erpnext.com/t/child-table-calculation/18840/24\r\n// frappe.ui.form.on('Lab Test Results', 'Setup', function(frm, cdt, cdn){\r\n// https://discuss.erpnext.com/t/how-to-call-an-event-within-another/14905        \r\n\r\n",
  "view": "Form"
 }
]